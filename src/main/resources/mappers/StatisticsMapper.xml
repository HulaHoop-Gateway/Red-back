<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hulahoop.redback.statistics.model.dao.StatisticsMapper">

    <!-- 통계: 오늘 이전 결제 내역을 날짜별·가맹점별 집계 -->
    <select id="selectDailyStatistics" resultType="com.hulahoop.redback.statistics.model.dto.StatisticsDTO">
<![CDATA[
        SELECT
            t.merchant_code AS merchantCode,
            COALESCE(m.merchant_name, '알 수 없음') AS merchantName,
            DATE(t.payment_date) AS paymentDate,
            COUNT(*) AS transactionCount,
            SUM(t.amount_used) AS totalAmount
        FROM T_TransactionHistory t
            LEFT JOIN T_Merchant m ON t.merchant_code = m.merchant_code
        WHERE t.payment_date < CURRENT_DATE()
        GROUP BY t.merchant_code, m.merchant_name, DATE(t.payment_date)
        ORDER BY paymentDate DESC
        ]]>
</select>




</mapper>
